(function(){var c,e,a,b,d;c=jQuery;e=true;d=function(f){return f.replace(/<img[^>]+data\-shortcode[^>]+[^>]*>/g,function(h){var g;h=c(h);g=h.data("shortcode");return decodeURIComponent(g)})};b=function(f){if(!e){return f}f=f.replace(/\[export2pdf_field([^\]]*)\]/g,function(l){var n,i,g,j,p,o,m,q,k,h;j="13px monospace";n=document.createElement("canvas");n.width=1000;n.height=200;if(!n.getContext||!n.toDataURL){e=false}else{i=n.getContext("2d");q=l;m=q.match(/form_field="([^"]+)"/);if(m){q=m[1]}q=window.export2pdf_form_fields[q]||q;i.font=j;k=i.measureText(q);h=Math.ceil(k.width);p=parseInt(i.font);p*=1.3;p=Math.ceil(p);n.width=h;n.height=p;i.textBaseline="top";i.font=j;i.fillText(q,0,0);o=n.toDataURL("image/png");g=c("<img />");g.addClass("export2pdf-field").attr("contenteditable","false").attr("unselectable","on").attr("title","Click to change options of this field").attr("data-shortcode",encodeURIComponent(l)).attr("src",o).attr("width",h).attr("height",p);return g[0].outerHTML}return l});return f};a=function(j,h,k){var i,g,l,f;h||(h=false);f=c('.export2pdf [name="template"]').val();i=window.ajaxurl+"?action=export2pdf_insert_field&template="+f;if(h){i+="&shortcode="+encodeURIComponent(h)}if(k){i+="&shortcode_doesnt_exist=1"}l=800;g=600;return j.windowManager.open({title:"Insert a field from your form",width:l,height:g,inline:0,file:i})};tinymce.PluginManager.add("export2pdf_insert_field",function(k,h){var s,m,g,r,l,o,p,n,j,f,q;k.on("init",function(i){return c(document).trigger("export2pdf:loaded")});k.on("BeforeSetContent",function(i){return i.content=b(i.content)});k.on("PostProcess",function(i){if(i.get){return i.content=d(i.content)}});k.on("mousedown",function(u){var i,t;t=u.target;i=k.dom.doc.body;if(k.dom.hasClass(t,"export2pdf-field")){window.export2pdf_insert_shortcode=function(v){v=b(v);return c(t).replaceWith(v)};a(k,decodeURIComponent(c(t).data("shortcode")));return false}return true});n=10;j=[];g=window.export2pdf_form_fields_groupped;for(m in g){l=g[m];q=[];for(r=o=0,p=l.length;o<p;r=++o){s=l[r];f=l.length-n;if(r>n&&(f>2)){q.push({text:"More fields... ("+f+")",onclick:function(){window.export2pdf_insert_shortcode=function(i){return k.selection.setContent(i)};return a(k,s.shortcode,true)}});break}else{(function(i){return q.push({text:i.name,onclick:function(){if(i.shortcode){return k.selection.setContent(i.shortcode)}else{window.export2pdf_insert_shortcode=function(t){return k.selection.setContent(t)};return a(k)}}})})(s)}}j.push({text:m,menu:q})}if(j.length===1&&j[0].text==="(none)"){j=j[0].menu}return k.addButton("export2pdf_insert_field",{title:"Export2PDF Field",type:"menubutton",icon:"export2pdf",text:"Insert a field",tooltip:"Insert a field from your form",menu:j})})}).call(this);