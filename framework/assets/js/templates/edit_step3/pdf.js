(function(){jQuery(document).ready(function(e){var d,b,a,c;c=e("#html_content").val();e(".export2pdf-preview-button").click(function(){c=e("#html_content").val();return true});window.onbeforeunload=function(){var f;tinyMCE.activeEditor.save();f=null;if(e("#html_content").val()!==c){f="There are some unsaved changes."}return f};d=e(".export2pdf-designer");if(!d.length){return}a=d.find(".export2pdf-page");a.each(function(){var h,g,j,f,i;g=e(this);h=g.find(".export2pdf-field");h.each(function(){var p,m,l,q,n,k,s,r,o;p=e(this);m=e("<div />");m.addClass("export2pdf-field-options").appendTo(p);s=e("<select />");n=e("<option />");n.attr("value","").html("").appendTo(s);k=window.export2pdf_form_fields;for(l in k){q=k[l];n=e("<option />");n.attr("value",l).html(q).attr("data-field",l).appendTo(s);if(p.data("info").mapped_field_id===l){n.prop("selected",true)}}s.appendTo(m);r=e('<span class="dashicons dashicons-admin-generic"></span>');r.attr("title","More options...").appendTo(m);o=function(){var x,u,y,v,t;t=800;y=Math.round(e(window).width()*0.9);if(t>y){t=y}x=Math.round(e(window).height()*0.9);u=e(window).height()-100;if(x>u){x=u}v=window.export2pdf.ajax_url+"?template="+encodeURIComponent(window.export2pdf.template.id)+"&field="+encodeURIComponent(p.data("info").id)+"&action=export2pdf_edit_field"+("&height="+x+"&width="+t+"&TB_iframe=true");return tb_show("Field Options",v)};p.click(function(){if(p.hasClass("export2pdf-nocontent")){o()}return false});r.click(function(){o();return false});return s.change(function(){var t,u;t=s.find("option:selected");u=s.val();if(u&&u.length){p.addClass("export2pdf-mapped");p.data("info").mapped=1;p.data("info").mapped_field_id=t.data("field")}else{p.removeClass("export2pdf-mapped");p.data("info").mapped=null;p.data("info").mapped_field_id=null}e.ajax({url:window.export2pdf.ajax_url,data:{action:"export2pdf_map_field_automatically",template:window.export2pdf.template.id,to_form_field:u,field:p.data("info").id}});return true})});f=g.data().info.width;j=g.data().info.height;i=function(){var n,l,k,m;n=e(".export2pdf-preview",g);k=n.width();l=n.height();m=k/f;h.each(function(){var x,u,o,t,r,q,s,v,w,p;x=e(this);p=x.data().info;r=p.x;q=p.y;t=p.width;o=p.height;s=t*m;u=o*m;v=r*m;w=q*m;x.css({width:s,height:u,left:v,top:w});x.find("select, span").css({lineHeight:(u-4)+"px"});if(p.mapped){x.addClass("export2pdf-mapped")}else{x.removeClass("export2pdf-mapped")}if(s<50||u<12){x.addClass("export2pdf-nocontent")}else{x.removeClass("export2pdf-nocontent")}return x.show()});return true};e(window).resize(i);i();return g.on("export2pdf:update-fields",i)});b=function(){var f,g,h;g=a.filter(".export2pdf-page-loading").eq(0);if(!g.length){return}h=g.data("preview");f=e("<img />");f.load(function(){g.removeClass("export2pdf-page-loading");g.trigger("export2pdf:update-fields");return b()});f.bind("error",function(){g.addClass("export2pdf-page-error");if(console&&console.error){return console.error("Error while loading page preview",h)}});return f.addClass("export2pdf-preview").prependTo(g).attr("src",h)};b();return window.export2pdf_updateField=function(f,g){e(".field_"+f+" select").each(function(){var h;e(this).find("option").prop("selected",false);h=e(this).find('option[data-field="'+g.mapped_field_id+'"]');h.attr("selected","selected");if(!h.length&&console&&console.error){return console.error("Could not find field with ID",g.mapped_field_id)}});e(".field_"+f+":not(.occurrence)").data("info",g);e(".field_"+f+".occurrence").each(function(){var h;h=e(this);h.data("info").mapped=g.mapped;h.data("info").mapped_field_id=g.mapped_field_id;return h.data("info").title=g.title});return e(window).trigger("resize")}})}).call(this);